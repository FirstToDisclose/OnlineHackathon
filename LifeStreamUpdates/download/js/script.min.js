function fetchServices(){$.n("Fetching available services..."),$.ajax({url:"services.json",dataType:"json"}).done(buildUI).fail(function(){$.n.error("Could not load service list. Please try reloading page.")})}function buildUI(e){$.n(e.length+" services available"),function(n,t,i,o,r){for(t=0,i=$("legend"),o=$('<div class="col"></div>').insertAfter(i);n>t;++t,i=o,o=$('<div class="col"></div>').insertAfter(i))for(r=t;r<e.length;r+=n)o.append('<div><label for="'+e[r]+'"><input type="checkbox" id="'+e[r]+'">'+e[r]+"</label></div>")}(4),checkboxes=$('input[type="checkbox"]').extend({enable:function(){return this.each(function(){$(this).removeAttr("disabled")}),this},disable:function(){return this.each(function(){$(this).attr("disabled","disabled")}),this}}),buttons.build.disable().click(function(e){e.preventDefault(),build()}),$("form").delegate('form input[type="checkbox"]',"change",function(){var e=0;return function(){this.checked?e++:e--,"undefined"!=typeof uglify&&(e>0?buttons.build.enable():buttons.build.disable())}}()),Downloadify.create("button-bar",{filename:function(){return"jquery.lifestream.custom.min.js"},data:function(){return builtScript},onComplete:onDownloadComplete,onError:function(){alert("You must put something in the File Contents or there will be nothing to save!")},transparent:!1,swf:"js/downloadify.swf",downloadImage:"img/download.png",width:100,height:30,append:!0}),setTimeout(function(){buttons.download=$("#button-bar > object").extend({enable:function(){return this.css({visibility:"visible"}),this},disable:function(){return this.css({visibility:"hidden"}),this}}),buttons.download.disable()},0),$.n("Loading UglifyJS..."),$.getScript("js/uglifyjs-cs.min.js").fail(function(){$.n.error("Could not load UglifyJS. Please reload the page")}).done(function(){$.n("UglifyJS received")})}function build(){$.n("Build started"),checkboxes.disable(),buttons.build.disable(),buildScript($('input[type="checkbox"]').filter(":checked").map(function(){return $(this).attr("id")}).get(),onBuildCompleted,onBuildFailure)}function onBuildCompleted(e){$.n("Build completed"),builtScript=e,buttons.download.enable()}function onBuildFailure(){$.n.error("Build failed, please retry"),builtScript="",checkboxes.enable(),buttons.build.enable()}function onDownloadComplete(){checkboxes.enable(),buttons.download.disable(),buttons.build.enable()}function buildScript(e,n,t){function i(e,n,t){"abort"==n?$.n.error("Aborted "+this.url):$.n.error("Could not retrieve module "+this.url+": "+e.status)}var o=[],r=[];$.n("Fetching src modules..."),$.ajax({url:"../src/core.js",dataType:"text",cache:!1}).fail(function(e,n,o){i.apply(this,arguments),t()}).done(function(a){o.push(a),$.whenArray(r=$.map(e,function(e){return $.ajax({url:"../src/services/"+e+".js",dataType:"text",cache:!1}).done(function(e){o.push(e)}).fail(function(e,n,t){i.apply(this,arguments)})})).done(function(){$.n("All src moduled received"),$.n("Uglification..."),n(uglify(o.join(";")))}).fail(function(){var e,n;for(e=0;e<r.length;++e)n=r[e],n.isResolved()||n.abort();t()})})}function parseQueryString(){var e={};window.location.search.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(n,t,i,o){e[t]=o}),e.mock="true"===e.mock,e.mock?($.n("Fetching Mockjax..."),$.getScript("js/jquery.mockjax.min.js").fail(function(){$.n.warning("Could not load Mockjax")}).done(function(){$.n("Received Mockjax");var n={errorProb:.5,minTime:0,maxTime:1e4};e.errorProb&&(e.errorProb=Number(e.errorProb)),e.minTime&&(e.minTime=Number(e.minTime)),e.maxTime&&(e.maxTime=Number(e.maxTime)),$.extend(n,e),$.n("Start mocking: "+JSON.stringify(n)),$.mockjax(function(e){var t=Math.random()<n.errorProb,i={responseTime:n.minTime+Math.random()*(n.maxTime-n.minTime)};return t?i.status=404:i.proxy=e.url,i})}).always(fetchServices)):fetchServices()}var buttons={build:$("#button").extend({enable:function(){return this.removeAttr("disabled"),this},disable:function(){return this.attr("disabled","disabled"),this}}).disable(),download:void 0},checkboxes,builtScript="";$.whenArray=function(e){return $.when.apply(this,e)},$.n.defaults.timeout=16e3,parseQueryString();
